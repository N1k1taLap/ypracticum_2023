# Прогнозирование оттока клиентов
# Описание задачи
Оператор связи «ТелеДом» хочет бороться с оттоком клиентов. Для этого его сотрудники начнут предлагать промокоды и специальные условия всем, кто планирует отказаться от услуг связи. Чтобы заранее находить таких пользователей, ТелеДому нужна модель, которая будет предсказывать, разорвёт ли абонент договор. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и услугах.
Исходя из ТЗ, для заказчика наиболее важным является качество модели, метрика auc должна быть выше 0.88. Про скорость обучения модели и время предсказания указаний дано не было.
# Цели
* Загрузить и изучить данные, а также провести их краткий анализ
* Отобрать необходимые для обучения данные
* Построить модель с auc score > 0.88, которая будет предсказывать, уйдет ли клиент из компании 
* Проанализировать значимость классов и составить портреты пользователей
# Вывод
* Предобработка была выполнена успешна, также был выполнен краткий анализ данных.
* С помощью библиотеки shap были соствлены портреты пользователей
* Лучшие результаты на валидационных данных показала модель Catboost. Для тестовой выборки эта модель показала auc score = 0.9145, при auc score в ТЗ > 0.88.
* Портреты пользователей были составлены, значимость классов исследована 
# Используемые библиотеки
* Matplotlib
* Pandas
* Sklearn
* Phik
* Catboost
* Shap
* Numpy



# Полный вывод
**Про предобработку**
* На этапе предобработки все датафреймы были объединены в один, что создало пропуски, если человек не пользовался какой-то из услуг. Эти пропуски были заменены на 'No'.<br>
Большe аномалий, пропусков и дубликатов в данных обнаружено не было.<br>
Был обработан только столбец Total_charges, т.к содержал пустую строку, если человек еще ничего не заплатил(заменил на 0)

**Про краткий анализ данных**
* На этапе анализа данных
был обнаружен дисбаланс классов.<br>
BeginDate, TotalCharges, Partner, MonthlyCharges, PaymentMethod - Признаки, которые имею наибольшую корреляцию с целевым.<br>
Корреляция между полом и расторжением договора близка к 0

Баланс классов<br>
* Type: кол-во month-to-month превышает сумму кол-ва остальных классов<br>
* PaperlessBilling: большая часть клиентов получает электронный расчетный лист<br>
* PaymentMethod: наиболее популярный вариант - Electronic check, остальные варианты встречаются с одиноковой частотой<br>
* gender: Мужчин и женщин +- одинаково<br>
* SeniorCitizen: Тут самый большой дисбалан. Пенсионеров всего примерно 16%<br>
* Partner: абонентов без супруга или супруги немного больше.<br>
* Dependents: Лишь у трети абонентов есть дети<br>
* InternetService: Среди абонентов наиболее популярный тип подклбчения интернета fiber optic(примерно 60%)<br>
* OnlineSecurity: Блокировщик интересует лишь 37%<br>
* OnlineBackup: Аналогично с предыдущим<br>
* DeviceProtection: Также<br>
* TechSupport: Аналогично<br>
* StreamingTV: Примерно равны<br>
* StreamingMovies: Примерно равны<br>
* MultipleLines: Телефон подключен одновременно к несколькоим линиям у чуть меньшего числа пользователей

**Про подготовку данных для обучению моделей**<br>
**Признаки для обучения моделей не включают:**<br>
* CustomerId<br>
* BeginDate и EndDate создадут утечку, поэтому были удалены<br>
* Gender, т.к. судя по матрице корреляций не имеет влияние на целевой признак

**Целевой признак**
* end

**Данные были разделены на тренировочную и тестовую выборки(размер тестовой 0.25)**
<br>


**Масштабирование было применено к столбцам MonthlyCharges и TotalCharges**
<br>


**Категориальные признаки были закодированы**
* OrdinalEncoder<br>
* OHE

**Про обучение моделей**<br>
Были обучены модели:
* Catboost<br>
* decision_tree<br>
* logistic_regressor<br>

Для всех моделей был применен GridSearch для поиска лучших гиперпараметрах с использованием кросс-валидации<br>
**Лучшие результаты метрики auc_roc показала модель catboost с гиперпараметрами**<br> 
* depth = 2<br>
* learning_rate = 0.401<br>
* iterarions = 550


**Про тестирование catboost**<br>
* С указанными выше гиперпараметрами на тестовой выборке auc_roc = 0.917669113673212 

**Про анализ значимости классов**
<br>Для определения верности клиента самым важным признаком является 
* **Кол-во дней, которые человек является клиентом**<br>

на втором месте:
* **TotalCharges**<br>

также важны:
* Monthly Charges
* Type
* Partner
* PaymentMethod

**Портрет лояльного клиента**
* Давно является клиентом
* В месяц платит не много
* В сумме заплатил немного
* Платит ежемесячно

**Портрет потенциального перебежчика**
* Среднее время или меньше является клиентом
* Крупная сумма платежей 
* Много платит в месяц
* Есть партнер

**Выводы по портретам**
* **Долгосрочные клиенты:** Те, кто долго находятся в компании, обычно либо удовлетворены текущим положением вещей, либо не стремятся к изменениям.
* **Малые ежемесячные платежи:** Клиенты, которые платят небольшие суммы каждый месяц, обычно не склонны уходить.
* **Малые общие платежи:** Клиенты, которые в общей сложности заплатили небольшую сумму, также реже уходят.
* **Ежемесячная оплата:** Возможно, ежемесячная оплата дает клиентам больше гибкости в изменении тарифов и отказе от услуг, что может объяснить, почему они реже покидают компанию.

По имеющимся данным тяжело определить, почему наличие брака влияет на отказ от услуг оператора.<br>
Возможно это связано с тем, что другие операторы предлагают более выгодные тарифы для пар или же делают скидку для тех, кто оформляет более широкий спектр услуг
